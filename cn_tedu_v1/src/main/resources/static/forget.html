<!DOCTYPE html>
<html>
<head>
    <title>验证用户</title>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/element-ui/2.15.9/theme-chalk/index.css">
    <style>
        .a .el-form-item__label {
            color: white
        }

    </style>
    <!--忘记密码页面-->
</head>
<body>
<div id="app">
    <el-container>
        <el-header height="80px" style="background-color: #E8E8E8">
            <el-row gutter="20">
                <el-col span="12" style="position: relative">
                    <img src="/img/WechatIMG21.png" width="196" height="65">
                    <span style="height:50px; color:darkseagreen;line-height: 65px;font-size: 30px;position: absolute;top: 5px">纸片阅读:想让你秃头</span>
                </el-col>
                <el-col span="6"></el-col>
                <el-col span="6" style="position: absolute ;top: 5px;right: 5px">
                    <a href="login.html">登录账号</a>
                </el-col>
            </el-row>
        </el-header>
        <el-main style="background-image: url('/img/9476.gif_wh300.gif');
                    height: 500px;background-size: cover;
                    background-position: center">
            <el-card style="width: 500px;height: 500px;margin: 50px auto;float: right;background-color:#666666 ">
                <el-form label-width="80px" style="width: 400px;margin: 50px 10px 50px; ">
                    <el-form-item class="a" label="用户名">
                        <el-input placeholder="请输入用户名" v-model="user.username"></el-input>
                    </el-form-item>
                    <el-form-item class="a" label="新密码">
                        <el-input type="password" placeholder="新密码包含字母和数字,长度在6到16个"
                                  v-model="user.password"></el-input>
                    </el-form-item>
                    <el-form-item class="a" label="输入密码">
                        <el-input type="password" placeholder="两次密码保持一致"
                                  v-model="user.secondPassword"></el-input>
                    </el-form-item>
                    <el-form-item class="a" label="密保问题">
                        <!--event.target.value给下拉框选项用value复制给变量-->
                        <select id="fruit-select" style="width: 320px;height: 40px;font-size: 10px"
                                @change="user.question = $event.target.value">
                            <!--第一个value默认不进行赋值-->
                            <option value="" disabled selected hidden>请选择一个问题</option>
                            <option value="您的父亲的名字?">您的父亲的名字?</option>
                            <option value="您的身份证号码?">您的身份证号码?</option>
                            <option value="您最难忘的事情?">您最难忘的事情?</option>
                        </select>
                    </el-form-item>
                    <el-form-item class="a" label="密保答案">
                        <el-input placeholder="请输入您的答案" v-model="user.answer"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="forget()">用户验证</el-button>
                    </el-form-item>
                </el-form>
            </el-card>
        </el-main>
        <el-footer style="height: 350px;background-color: darkseagreen;padding: 50px 0">
            <div class="center" style="text-align: center;color: #666">
                <el-row>
                    <el-col span="12">
                        <img src="WechatIMG21.png">

                    </el-col>
                    <el-col span="12">
                        <el-row id="footer_center">
                            <el-col span="12">
                                <h3>纸片读书网</h3>
                                <p>关于纸片</p>
                                <p>隐私协议</p>
                                <p>版权声明</p>
                                <p>用户协议</p>
                            </el-col>
                            <el-col span="12">
                                <h3>加入纸片</h3>
                                <p>签约作者</p>
                                <p>广告投放</p>
                                <p>社会招聘</p>
                                <p>友情链接</p>
                            </el-col>

                        </el-row>

                    </el-col>

                </el-row>
            </div>
        </el-footer>
    </el-container>
</div>
</body>
<!-- import Vue before Element -->
<script src="https://cdn.staticfile.org/vue/2.6.14/vue.min.js"></script>
<!-- import JavaScript -->
<script src="https://cdn.staticfile.org/element-ui/2.15.9/index.min.js"></script>
<!--引入Axios-->
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
<script>
    let v = new Vue({
        el: '#app',
        data: function () {
            return {
                user: {
                    username: "", question: "", answer: "", password: "", secondPassword: ""
                }

            }
        },
        methods: {
            /*增加一个else判断两次输入的密码是否一致*/
            forget() {
                if (v.user.password == v.user.secondPassword) {
                    if (v.user.username.length === 0 ||
                        v.user.question.length === 0 || v.user.answer.length === 0
                    ) {
                        v.$message.error("选项不能为空");
                        return;
                    }
                    let regex = /^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{6,16}$/;
                    if (!regex.test(v.user.password)) {
                        v.$message.error("用户名格式不正确");
                        return;
                    }
                    axios.post("/v1/users/forget", v.user).then((function (response) {

                        switch (response.data.code) {
                            case 1000:
                                alert("验证成功,请登录!")
                                /*跳转到登录页*/
                                location.href = "login.html";
                                break;
                            case 1004:
                                v.$message.error("验证失败,还有2次机会!")
                                break;
                            case 1005:
                                v.$message.error("验证失败,还有1次机会!")
                                break;
                            case 1006:
                                v.$message.error("验证失败,今日已无机会,明日再来!")
                                break;
                        }
                    }));

                } else {
                    v.$message.error("两次密码不一致请重新填写!");
                    return;
                }


            }
        }
    })
</script>
</html>