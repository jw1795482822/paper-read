<!DOCTYPE html>
<html>
<head>
    <title>注册页面</title>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/element-ui/2.15.9/theme-chalk/index.css">
    <style>
        .a .el-form-item__label {
            color: white
        }

    </style>
</head>
<body>
<div id="app">
    <el-container>
        <el-header height="80px" style="background-color: #E8E8E8">
            <el-row gutter="20">
                <el-col span="12" style="position: relative">
                    <img src="/img/WechatIMG21.png" width="196" height="65">
                    <span style="height:50px; color:darkseagreen;line-height: 65px;font-size: 30px;position: absolute;top: 5px">纸片阅读:想让你秃头</span>
                </el-col>
                <el-col span="6"></el-col>
                <el-col span="6" style="position: absolute ;top: 5px;right: 5px">
                    <a href="login.html">登录账号</a>
                </el-col>
            </el-row>
        </el-header>
        <el-main style="background-image: url('/img/9476.gif_wh300.gif');
                    height: 500px;background-size: cover;
                    background-position: center">
            <el-card style="width: 500px;height: 560px;margin: 50px auto;float: right;background-color:#666666 ">
                <el-form label-width="80px" style="width: 400px;margin: 10px 10px 50px; ">
                    <el-form-item class="a" label="邮箱">
                        <el-input placeholder="填写正确格式" v-model="user.email"></el-input>
                        <button type="button" id="send-code-btn" @click="send()">发送验证码</button>
                    </el-form-item>
                    <el-form-item  class="a" label="验证码">
                        <el-input placeholder="填写邮箱验证码" v-model="user.code"></el-input>
                    </el-form-item>
                    <el-form-item  class="a" label="用户名">
                        <el-input placeholder="包含字母和数字,长度在3到16个" v-model="user.username"></el-input>
                    </el-form-item>
                    <el-form-item class="a" label="昵称">
                        <el-input placeholder="请输入昵称" v-model="user.nickname"></el-input>
                    </el-form-item>
                    <el-form-item class="a" label="密码">
                        <el-input type="password" placeholder="包含字母和数字,长度在6到16个"
                                  v-model="user.password"></el-input>
                    </el-form-item>
                    <el-form-item class="a" label="密保问题">
                        <!--event.target.value给下拉框选项用value复制给变量-->
                        <select id="fruit-select" style="width: 320px;height: 40px;font-size: 10px"
                                @change="user.question = $event.target.value">
                            <!--第一个value默认不进行赋值-->
                            <option value="" disabled selected hidden>请选择一个问题</option>
                            <option value="您的父亲的名字?">您的父亲的名字?</option>
                            <option value="您的身份证号码?">您的身份证号码?</option>
                            <option value="您最难忘的事情?">您最难忘的事情?</option>
                        </select>
                    </el-form-item>
                    <el-form-item class="a" label="密保答案">
                        <el-input placeholder="请输入您的答案" v-model="user.answer"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="reg()">注册</el-button>
                    </el-form-item>
                </el-form>
            </el-card>
        </el-main>
        <el-footer style="height: 350px;background-color: darkseagreen;padding: 50px 0">
            <div class="center" style="text-align: center;color: #666">
                <el-row>
                    <el-col span="12">
                        <img src="/img/WechatIMG21.png">
                    </el-col>
                    <el-col span="12">
                        <el-row id="footer_center">
                            <el-col span="12">
                                <h3>纸片读书网</h3>
                                <p>关于纸片</p>
                                <p>隐私协议</p>
                                <p>版权声明</p>
                                <p>用户协议</p>
                            </el-col>
                            <el-col span="12">
                                <h3>加入纸片</h3>
                                <p>签约作者</p>
                                <p>广告投放</p>
                                <p>社会招聘</p>
                                <p>友情链接</p>
                            </el-col>

                        </el-row>

                    </el-col>

                </el-row>
            </div>
        </el-footer>
    </el-container>
</div>
</body>
<!-- import Vue before Element -->
<script src="https://cdn.staticfile.org/vue/2.6.14/vue.min.js"></script>
<!-- import JavaScript -->
<script src="https://cdn.staticfile.org/element-ui/2.15.9/index.min.js"></script>
<!--引入Axios-->
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
<script>
    let v = new Vue({
        el: '#app',
        data: function () {
            return {
                user: {
                    username: "", password: "", nickname: "", question: "", answer: "",email:"", code: "",
                }

            }
        },
        methods: {
            send() {
                //^ 表示匹配字符串的开始位置。
                //([a-zA-Z0-9_\-\.]+) 表示匹配一个或多个字母、数字、下划线、短横线或点号。
                //@ 表示匹配一个 @ 符号。
                //([a-zA-Z0-9_\-\.]+) 表示匹配一个或多个字母、数字、下划线、短横线或点号。
                //\. 表示匹配一个点号。
                //([a-zA-Z]{2,5}) 表示匹配两到五个字母。
                //$ 表示匹配字符串的结束位置。
                let email_regex = /^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/
                //let email_regex = /^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{6,16}$/;
                if (!(email_regex.test(v.user.email))) {
                    v.$message.error("邮箱格式格式不正确");
                    return;
                }
                axios.get("/v1/users/send?email=" + v.user.email).then(function (response) {
                    if (response.data.code == 1000) {
                        v.$message.success("发送验证码成功");
                    }else {
                        alert("发送验证码失败");
                        return;
                    }

                });
                // 将按钮变为不可用状态
                var btn = document.getElementById('send-code-btn');
                btn.disabled = true;

                // 开始倒计时
                var count = 120;
                var timer = setInterval(function() {
                    count--;
                    btn.innerHTML = count + '秒后重新发送';
                    if (count == 0) {
                        clearInterval(timer);
                        btn.innerHTML = '发送验证码';
                        btn.disabled = false;
                    }
                }, 1000);


            },

            reg() {
                if (v.user.nickname.length === 0 || v.user.username.length === 0 ||
                    v.user.question.length === 0 || v.user.answer.length === 0 ||
                    v.user.password.length === 0) {
                    alert("选项不能为空");
                    return;

                }
                let regex = /^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{6,16}$/;

                if (!regex.test(v.user.username)) {
                    v.$message.error("用户名格式不正确");
                    return;
                }
                if (!regex.test(v.user.password)) {
                    v.$message.error("密码格式不正确");
                    return;
                }
                axios.post("/v1/users/reg", v.user).then((function (response) {
                    if (response.data.code == 1000) {

                        v.$message.success("注册成功");
                        location.href = "/";
                    } else  {
                        alert(response.data.misDescription)
                    }
                }))


            }
        }
    })
</script>
</html>